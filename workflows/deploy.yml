name: Deploy to Cloudflare Workers with Wrangler
uses: cloudflare/wrangler-action@2.0.0

on:
  push:
    branches:
      - main
  workflow_dispatch:
    inputs:
      environment:
        description: "Choose an environment to deploy to: <main|preview>"
        required: true
        default: "preview"
  jobs:
    deploy:
      runs-on: ubuntu-latest
      name: Deploy
      steps:
        - uses: actions/checkout@v3
        - name: Publish
          uses: cloudflare/wrangler-action@2.0.0
          with:
            apiToken: ${{ secrets.CF_API_TOKEN }}
            command: publish --env ${{ github.event.inputs.environment }}
# jobs:
#   build:
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout repository and update Hugo themes
#         uses: actions/checkout@v2
#         with:
#           submodules: true
#           fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod

#       - name: Install Hugo
#         uses: peaceiris/actions-hugo@v2
#         with:
#           hugo-version: "0.92.1"
#           extended: true

#       - name: Build Hugo
#         run: hugo --minify

#       - name: Deploy to Cloudflare work
#         uses: peaceiris/actions-gh-pages@v3
#         with:
#           github_token: ${{ secrets.GITHUB_TOKEN }}
#           publish_dir: ./public

#       - name: Purge Cloudflare Cache
#         env:
#           CLOUDFLARE_ZONE_ID: ${{ secrets.CLOUDFLARE_ZONE_ID }}
#           CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
#           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#         run: |
#           chmod +x ./purge_cloudflare_cache.sh
#           ./purge_cloudflare_cache.sh
